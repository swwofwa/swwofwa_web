!function(){var e=wp.media.view.AttachmentFilters.extend({id:"media-attachment-taxonomy-filter",createFilters:function(){var e={};folders_media_options.terms.length;_.each(folders_media_options.terms||{},(function(t,a){e[t.term_id]={text:t.name+" ("+t.trash_count+")",props:{media_folder:t.slug}}})),e.all={text:"All Folders",props:{media_folder:""},priority:10},e.unassigned={text:"(Unassigned)",props:{media_folder:"-1"},priority:10},this.filters=e},change:function(){var e={};_.each(folders_media_options.terms||{},(function(t,a){e[t.term_id]={text:t.name+" ("+t.trash_count+")",props:{media_folder:t.slug}}})),e.all={text:"Select a folder >>",props:{media_folder:""},priority:10},e.unassigned={text:"(Unassigned)",props:{media_folder:"-1"},priority:10},this.filters=e;var t=this.filters[this.el.value];t&&this.model.set(t.props)}}),t=wp.media.view.AttachmentsBrowser;wp.media.view.AttachmentsBrowser=wp.media.view.AttachmentsBrowser.extend({createToolbar:function(){t.prototype.createToolbar.call(this),this.toolbar.set("MediaLibraryOrganizerTaxonomyFilter",new e({controller:this.controller,model:this.collection.props,priority:-75}).render())}});var a,r=wp.media.model.Query;_.extend(r,{get:(a=[],function(e,t){var o,i={},d=r.orderby,l=r.defaultProps;return delete e.query,delete e.cache,_.defaults(e,l),_.each(["include","exclude"],(function(t){e[t]&&!_.isArray(e[t])&&(e[t]=[e[t]])})),_.each(e,(function(e,t){_.isNull(e)||(i[r.propmap[t]||t]=e)})),_.defaults(i,r.defaultArgs),i.orderby=d.valuemap[e.orderby]||e.orderby,a=[],o||(o=new r([],_.extend(t||{},{props:e,args:i})),a.push(o)),o})})}(jQuery,_),jQuery(document).on("click",".media-frame-router .media-menu-item",(function(){setTimeout((function(){if(lastFolderData.length>0&&jQuery(".folder_for_media option").length!=lastFolderData.length+2){var e=jQuery(".folder_for_media").val(),t=jQuery(".folder_for_media");for(t.html("<option value='-1'>(Unassigned)</option>"),i=0;i<lastFolderData.length;i++)t.append("<option value='"+lastFolderData[i].term_id+"'>"+lastFolderData[i].name+"</option>");t.append("<option value='add-folder'>+ Create a New Folder</option>"),""!=selectedFolderMediaId&&null!=selectedFolderMediaId?t.val(selectedFolderMediaId):t.val(e)}}),100)}));var selectedFolderMediaId=-1,selectedFolderPageID="all",filesInQueue=0,uploadedFileCount=0,lastFolderData=[];function resetDDCounter(){var e=jQuery("#media-attachment-taxonomy-filter").val();jQuery.ajax({url:folders_media_options.ajax_url,data:"type=attachment&action=wcp_get_default_list&active_id=0",method:"post",success:function(t){t=jQuery.parseJSON(t),jQuery("#media-attachment-taxonomy-filter").length&&jQuery("#media-attachment-taxonomy-filter").each((function(){folders_media_options.terms=t.taxonomies;var a=jQuery(this);for(a.html("<option value='all'>All Folders</option><option value='unassigned'>(Unassigned)</option>"),lastFolderData=t.taxonomies,i=0;i<t.taxonomies.length;i++)a.append("<option value='"+t.taxonomies[i].term_id+"'>"+t.taxonomies[i].name+" ("+t.taxonomies[i].trash_count+")</option>");a.val(e).trigger("change"),!1!==resetMediaID&&a.val(resetMediaID).trigger("change")})),resetMediaID=!1}})}function resetSelectMediaDropDown(){jQuery.ajax({url:folders_media_options.ajax_url,data:"type=attachment&action=wcp_get_default_list&active_id=0",method:"post",success:function(e){if(e=jQuery.parseJSON(e),jQuery(".folder_for_media").length){if(!jQuery("#wcp-content").length){var t=jQuery(".folder_for_media");for(t.html("<option value='-1'>(Unassigned)</option>"),lastFolderData=e.taxonomies,i=0;i<e.taxonomies.length;i++)t.append("<option value='"+e.taxonomies[i].term_id+"'>"+e.taxonomies[i].name+" ("+e.taxonomies[i].trash_count+")</option>");t.append("<option value='add-folder'>+ Create a New Folder</option>")}jQuery("#custom-folder-media-popup-form").remove()}jQuery("#media-attachment-taxonomy-filter").length||0==resetMediaID?resetDDCounter():jQuery(".folder_for_media").val(resetMediaID).trigger("change")}})}jQuery(document).on("change",".folder_for_media",(function(){"add-folder"!=jQuery(this).val()&&null!=jQuery(this).val()?selectedFolderMediaId=jQuery(this).val():"add-folder"==jQuery(this).val()&&(selectedFolderMediaId=-1,jQuery("#wcp-content").length||(0==folders_media_options.is_key_active&&folders_media_options.folders>=10?(jQuery("#custom-folder-media-popup-form").length&&jQuery("#custom-folder-media-popup-form").remove(),jQuery("#custom-folder-media-popup-form").length||(jQuery("body").append("<div class='folder-media-popup-form' id='custom-folder-media-popup-form'></div>"),jQuery("#custom-folder-media-popup-form").append("<div class='media-popup-form' id='custom-popup-form-content'></div>"),jQuery(".media-popup-form").append('<div id="add-update-folder-title" class="add-update-folder-title">You\'ve reached the 10 folder limitation!</div>'),jQuery(".media-popup-form").append('<div class="folder-form-message">Unlock unlimited amount of folders by upgrading to one of our pro plans.</div>'),jQuery(".media-popup-form").append('<div class="folder-form-buttons"><a href="javascript:;" class="remove-media-form">Cancel</a><a href="'+folders_media_options.activate_url+'" target="_blank" class="form-submit-btn" style="width: 120px">See Pro Plans</button></div>'))):(jQuery("#custom-folder-media-popup-form").length&&jQuery("#custom-folder-media-popup-form").remove(),jQuery("#custom-folder-media-popup-form").length||(jQuery("body").append("<div class='folder-media-popup-form' id='custom-folder-media-popup-form'></div>"),jQuery("#custom-folder-media-popup-form").append("<div class='media-popup-form' id='custom-popup-form-content'></div>"),jQuery("#custom-popup-form-content").append("<form action='#' id='folder-media-popup-form' method='post'></form>"),jQuery("#folder-media-popup-form").append('<div id="add-update-folder-title" class="add-update-folder-title">Add new folder</div>'),jQuery("#folder-media-popup-form").append('<div class="folder-form-input"><input id="media-folder-name" autocomplete="off" placeholder="Folder name" class=""></div>'),jQuery("#folder-media-popup-form").append('<div class="folder-form-errors" id="media-form-error"><span class="dashicons dashicons-info"></span> Please enter folder name</div>'),jQuery("#folder-media-popup-form").append('<div class="folder-form-buttons"><button type="submit" class="form-submit-btn" id="save-media-folder" style="width: 106px">Submit</button><a href="javascript:;" class="remove-media-form">Cancel</a></div>'),jQuery("#media-folder-name").focus())))),jQuery(".media-toolbar #media-attachment-taxonomy-filter").length&&(jQuery("#media-attachment-taxonomy-filter").val(jQuery(this).val()),jQuery("#media-attachment-taxonomy-filter").trigger("change"))})),jQuery(document).on("change","#media-attachment-taxonomy-filter",(function(){null!=jQuery(this).val()&&"add-folder"!=jQuery(this).val()&&(jQuery(".folder_for_media").val(jQuery(this).val()),selectedFolderPageID=jQuery(this).val(),selectedFolderMediaId=jQuery(this).val())}));var wp=window.wp,hasNoMedia=!1,fileUploadArray=[];void 0!==wp&&"function"==typeof wp.Uploader&&(wp.media.view.Modal.prototype.on("open",(function(){setTimeout((function(){jQuery("#media-attachment-taxonomy-filter").length&&("all"==jQuery("#media-attachment-taxonomy-filter").val()&&(jQuery("#media-attachment-taxonomy-filter option:gt(1)").remove(),_.each(folders_media_options.terms,(function(e,t){jQuery("#media-attachment-taxonomy-filter").append("<option value='"+e.term_id+"'>"+e.name+" ("+e.trash_count+")</option>")}))),jQuery("#wcp-content").length||jQuery(".editor-post-featured-image").length&&jQuery(".attachment-filters").val(selectedFolderPageID).trigger("change"))}),100)})),jQuery.extend(wp.Uploader.prototype,{progress:function(){},init:function(){this.uploader&&(this.uploader.bind("FileFiltered",(function(e,t){fileUploadArray.push(selectedFolderMediaId),filesInQueue++,jQuery(".attachments li").length?jQuery(".attachments li:first-child").before('<li id="file-'+t.id+'" class="attachment first-file-uploads temp-attachment-li uploading save-ready"> <div class="attachment-preview"> <div class="thumbnail"> <div class="media-progress-bar"><div style=""></div></div> </div> </div> </li>'):(hasNoMedia=!0,jQuery("p.no-media").hide(),jQuery(".attachments-wrapper ul.attachments").append('<li id="file-'+t.id+'" class="attachment first-file-uploads temp-attachment-li uploading save-ready"> <div class="attachment-preview"> <div class="thumbnail"> <div class="media-progress-bar"><div style="width:0%"></div></div> </div> </div> </li>')),jQuery(".folder-meter").css("width","0%"),jQuery(".media-folder-loader").show(),jQuery("#total_upload_files").text(filesInQueue)})),this.uploader.bind("BeforeUpload",(function(e,t){var a,r=e.settings.multipart_params;if((a=parseInt(fileUploadArray[uploadedFileCount]))>0&&(r.folder_for_media=a),uploadedFileCount<filesInQueue){jQuery(".media-folder-loader").show();var o=uploadedFileCount/filesInQueue*100;jQuery(".folder-meter").css("width",o+"%")}uploadedFileCount++,jQuery("#current_upload_files").text(uploadedFileCount)})),this.uploader.bind("FileUploaded",(function(e,t){if(void 0!==t.attachment.attributes.url){var a=t.attachment.attributes,r="<div class='attachment-preview js--select-attachment type-"+a.type+" subtype-"+a.subtype+" "+a.orientation+"'><div class='thumbnail'>";"image"===a.type&&a.size&&a.size.url?r+='<div class="centered"><img src="'+a.size.url+'" draggable="false" alt="" /></div>':("image"===a.type&&a.sizes&&a.sizes.thumbnail&&a.sizes.thumbnail.url?r+='<div class="centered"><img src="'+a.sizes.thumbnail.url+'" class="thumbnail" draggable="false" alt="" /></div>':"image"===a.type&&a.url?r+='<div class="centered"><img src="'+a.url+'" class="thumbnail" draggable="false" alt="" /></div>':a.image&&a.image.src&&a.image.src!==a.icon?r+='<div class="centered"><img src="'+a.image.src+'" class="thumbnail" draggable="false" alt="" /></div>':a.sizes&&a.sizes.medium?r+='<div class="centered"><img src="'+a.sizes.medium.url+'" class="thumbnail" draggable="false" alt="" /></div>':r+='<div class="centered"><img src="'+a.icon+'" class="icon" draggable="false" alt="" /></div>',"image"!=a.type&&(r+='<div class="filename"><div>'+a.filename+"</div></div>")),r+="</div></div>",jQuery("#file-"+t.id).html(r).removeClass("uploading").addClass("save-ready ui-draggable ui-draggable-handle").removeClass("temp-attachment-li")}else jQuery("#file-"+t.id).remove()})),this.uploader.bind("Error",(function(e,t,a,r){if(t.file&&t.file.id&&jQuery("#file-"+t.file.id).length&&jQuery("#file-"+t.file.id).remove(),-1!=t.file.type.indexOf("svg")&&!jQuery(".upload-error.fldr-svg-error").length>0){var o='<div class="upload-error fldr-svg-error"><strong>'+folders_media_options.lang.pro_message+'</strong><br /><a target="_blank" href="'+folders_media_options.activate_url+'"> '+folders_media_options.lang.activate_key+" 🎉</a></div>";jQuery(".media-sidebar .upload-errors").append(o)}})),this.uploader.bind("UploadProgress",(function(e,t){parseInt(t.percent)<100&&jQuery("#file-"+t.id+" .media-progress-bar > div").css("width",parseInt(t.percent)+"%")})),this.uploader.bind("UploadComplete",(function(e,t){selectedFolderMediaId=-1})),this.uploader.bind("UploadComplete",(function(e,t){jQuery(".temp-attachment-li").remove(),hasNoMedia&&jQuery(".first-file-uploads").remove(),hasNoMedia=!1;var a=window.wp;jQuery(".folder-meter").css("width","100%"),setTimeout((function(){jQuery(".media-folder-loader").hide(),jQuery(".folder-meter").css("width","0%"),filesInQueue=0,uploadedFileCount=0,fileUploadArray=[]}),1250),resetDDCounter(),void 0!==a.media.frame&&null!==a.media.frame.content.get()&&void 0!==a.media.frame.content.get().collection?(folderSelectedAttachmentID="",jQuery(".folder-modal ul.attachments li.selected").length&&(folderSelectedAttachmentID=jQuery(".folder-modal ul.attachments li.selected").data("id")),a.media.frame.content.get().collection.props.set({ignore:+new Date}),a.media.frame.content.get().options.selection.reset()):jQuery("#media-attachment-taxonomy-filter").length&&jQuery(".attachment-filters").each((function(){jQuery(this).trigger("change")}))})))}})),jQuery(document).ajaxComplete((function(e,t,a){null!=a.data&&"string"==typeof a.data&&a.data.indexOf("action=delete-post")>-1&&resetDDCounter()})),jQuery(document).on("click","#menu-item-browse",(function(e){setTimeout((function(){resetMediaScreen&&resetDDCounter()}),100)}));var resetMediaScreen=!1,resetMediaID=!1;jQuery(document).on("submit","#folder-media-popup-form",(function(){if(""==jQuery.trim(jQuery("#media-folder-name").val()))jQuery("#media-form-error").show(),jQuery("#media-folder-name").focus();else{jQuery("button#save-media-folder").html("<span class='spinner-border'></span>"),jQuery("button#save-media-folder").attr("disabled",!0);var e=-1;jQuery(".folder_for_media option").each((function(){thisText=jQuery(this).text(),""!=jQuery.trim(thisText[0])&&e++})),jQuery.ajax({url:folders_media_options.ajax_url,data:"action=wcp_add_new_folder&parent_id=0&is_from_media=1&type=attachment&term_id=0&order="+e+"&name="+jQuery.trim(jQuery("#media-folder-name").val())+"&nonce="+folders_media_options.nonce,type:"post",success:function(e){result=jQuery.parseJSON(e),"1"==result.status?(resetMediaID=result.id,folders_media_options.is_key_active=result.is_key_active,folders_media_options.folders=result.folders,resetSelectMediaDropDown(),resetMediaScreen=!0):(jQuery(".folder-form-errors").html(result.message).show(),jQuery("button#save-media-folder").attr("disabled",!1),jQuery("button#save-media-folder").html("Submit"))}})}return!1})),jQuery(document).on("click",".remove-media-form",(function(e){e.stopPropagation(),jQuery("#custom-folder-media-popup-form").remove(),jQuery(".folder_for_media").val("-1").trigger("change"),jQuery("#media-attachment-taxonomy-filter").each((function(){jQuery(this).val("all").trigger("change")}))})),jQuery(document).on("click","#custom-folder-media-popup-form",(function(e){jQuery("#custom-folder-media-popup-form").remove(),jQuery(".folder_for_media").val("-1").trigger("change"),jQuery("#media-attachment-taxonomy-filter").each((function(){jQuery(this).val("all").trigger("change")}))})),jQuery(document).on("click",".media-popup-form",(function(e){e.stopPropagation()}));